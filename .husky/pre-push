#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üöÄ Running pre-push hooks..."

# Get the current branch
current_branch=$(git rev-parse --abbrev-ref HEAD)

# Skip checks for main/master branch pushes (usually handled by CI)
if [ "$current_branch" = "main" ] || [ "$current_branch" = "master" ]; then
  echo "‚è≠Ô∏è  Skipping pre-push hooks for main/master branch"
  exit 0
fi

# Run full validation
echo "üîç Running full validation suite..."
npm run validate

# Check for TODO/FIXME comments in staged files (warning only)
echo "üìã Checking for TODO/FIXME comments..."
todos=$(git diff --name-only origin/main..HEAD -- '*.ts' '*.tsx' | xargs grep -l "TODO\|FIXME" 2>/dev/null || true)
if [ ! -z "$todos" ]; then
  echo "‚ö†Ô∏è  Warning: Found TODO/FIXME comments in:"
  echo "$todos"
  echo "Consider addressing these before pushing to main branch."
fi

# Check bundle size (if significant changes)
echo "üì¶ Checking bundle size..."
npm run analyze:bundle > /dev/null 2>&1 || echo "‚ö†Ô∏è  Could not analyze bundle size"

echo "‚úÖ Pre-push hooks completed successfully!"